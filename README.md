# Master Thesis

## Computer Science, University of Trento - DISI, 2020

### Supervisor: Silvio Ranise 

### Co-Supervisor: Andrea Bisegna, Roberto Carbone

### Student: Pellizzari Giulio

### Title: Micro-Id-Gym: a Tool to Support Sandboxing and Automated Pentesting of Identity Management Protocols

## Abstract
Thanks to spread of web applications and the digitalization of our society people started using more and more frequently online services. These services usually require the registration of a user account to access the benefits they offer. Password-based authentication is one of the most common techniques used to verify user identity but, considering the large number of online services the user needs to access, this authentication mechanism forces people to remind lots of passwords. For this reason, even if best practices discourage that, people tend to reuse the same password across multiple accounts thus exposing themselves to a higher level of risk. To tackle this issue, Single Sign-On (SSO) has been introduced. SSO is an authentication schema allowing the user to access different services using the same set of credentials. 
In this thesis, we focused on the protocols implementing this authentication schema where a Client server relies on a trusted third-party server, the Identity Provider, for user authentication. These protocols have been identified as Identity Management (IdM) protocols. A system implementing an IdM protocol is hereafter referred as IdM systems. In this work, we focus on two of the most known IdM protocol: SAML 2.0 SSO and OAuth 2.0/OpenID Connect. Since several vulnerabilities on the implementation of these protocols have been detected, we investigate the state of the art to discover if there were any tools to assist system administrators and developers in the implementation of IdM protocols. As the first contribution, we provide a comprehensive analysis of the actual state of the art of the (semi-)automated pentesting tools to detect vulnerabilities in IdM systems. Using what we learned from the state of the art, we design and implement Micro-Id-Gym (MIG), the main contribution of this thesis. MIG is a tool to support the creation of sandboxes containing IdM system and perform automated pentesting of IdM protocols. MIG consists of three main parts: MIG Backend, MIG Frontend and the dashboard. MIG Backend contains a set of instances of Client and Identity Provider used to recreate IdM system in a sandbox and a repository of Cyber Threat Intelligence information. MIG Frontend provides the tools to support and automate the pentesting activities of IdM protocols. The dashboard is used to set up an IdM system in a sandbox and to configure MIG Frontend tools.
As the last contribution of this thesis, we describe three use cases that prove the effectiveness of MIG. In the first one, we used MIG to test an IdM system in the wild. We collaborate with an important Italian Identity Provider that implements strong authentication required by PSD2 standard to assess the security of its service. We discovered three relevant vulnerabilities and some misconfiguration on the tested IdM system. In the second use case, we tested an industrial IdM system belonging to Italian National Mint and Printing House. We used MIG during the development process to spot vulnera- bilities before the IdM system deployment and we discover two misconfiguration and a vulnerability potentially leading to Cross-Site Request Forgery attacks. Finally, in the third use case, we propose to use MIG for a hands-on experience of pentesting IdM protocols during a security class at the uni- versity. After the execution of an IdM system in a sandbox, the students perform pentesing activities to learn IdM protocols, the vulnerabilities they might suffer, which attacks can exploit them and the countermeasures that can be implemented.
